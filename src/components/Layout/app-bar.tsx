import { FC } from "react";
import { AppBar, UserMenu, MenuItemLink, useTranslate } from "react-admin";
import { AppBarProps, UserMenuProps as UserMenuPropsMUI } from "ra-ui-materialui";
import SettingsIcon from "@material-ui/icons/Settings";
import { makeStyles, useMediaQuery } from "@material-ui/core";

import { Logo } from "./logo";
import { GlobalSearch } from "../GlobalSearch/global-search";
import { MEDIA_QUERIES_BREAKPOINTS } from "../../constants/style-constants";
import { AppBarStyles } from "./styles";
import { RosingLogo } from "../../constants/icons";

interface UserMenuProps extends UserMenuPropsMUI {
  onClick?: () => void;
}

const useStyles = makeStyles(AppBarStyles);

const RosingHeaderLogo = () => (
  <svg width="167" height="10" viewBox="0 0 167 10" fill="none" xmlns="http://www.w3.org/2000/svg">
    <path
      d="M5.628 9L3.852 5.94H2.22V9H0.84V0.599999H4.2C4.952 0.599999 5.588 0.864 6.108 1.392C6.636 1.912 6.9 2.548 6.9 3.3C6.9 3.836 6.744 4.328 6.432 4.776C6.128 5.216 5.728 5.536 5.232 5.736L7.14 9H5.628ZM2.22 1.896V4.704H4.2C4.568 4.704 4.88 4.568 5.136 4.296C5.392 4.024 5.52 3.692 5.52 3.3C5.52 2.908 5.392 2.576 5.136 2.304C4.88 2.032 4.568 1.896 4.2 1.896H2.22ZM16.3608 7.896C15.5208 8.736 14.4928 9.156 13.2768 9.156C12.0608 9.156 11.0288 8.736 10.1808 7.896C9.34078 7.048 8.92078 6.016 8.92078 4.8C8.92078 3.584 9.34078 2.556 10.1808 1.716C11.0288 0.867999 12.0608 0.443999 13.2768 0.443999C14.4928 0.443999 15.5208 0.867999 16.3608 1.716C17.2088 2.556 17.6328 3.584 17.6328 4.8C17.6328 6.016 17.2088 7.048 16.3608 7.896ZM11.1528 6.96C11.7288 7.528 12.4368 7.812 13.2768 7.812C14.1168 7.812 14.8208 7.528 15.3888 6.96C15.9648 6.384 16.2528 5.664 16.2528 4.8C16.2528 3.936 15.9648 3.22 15.3888 2.652C14.8208 2.076 14.1168 1.788 13.2768 1.788C12.4368 1.788 11.7288 2.076 11.1528 2.652C10.5848 3.22 10.3008 3.936 10.3008 4.8C10.3008 5.664 10.5848 6.384 11.1528 6.96ZM22.5712 9.156C21.7632 9.156 21.0752 8.972 20.5072 8.604C19.9472 8.236 19.5552 7.732 19.3312 7.092L20.5192 6.396C20.8552 7.34 21.5512 7.812 22.6072 7.812C23.1272 7.812 23.5152 7.712 23.7712 7.512C24.0352 7.304 24.1672 7.036 24.1672 6.708C24.1672 6.364 24.0272 6.104 23.7472 5.928C23.4672 5.744 22.9712 5.544 22.2592 5.328C21.8592 5.208 21.5352 5.096 21.2872 4.992C21.0392 4.888 20.7752 4.744 20.4952 4.56C20.2232 4.368 20.0192 4.132 19.8832 3.852C19.7472 3.572 19.6792 3.244 19.6792 2.868C19.6792 2.124 19.9432 1.536 20.4712 1.104C20.9992 0.663999 21.6352 0.443999 22.3792 0.443999C23.0512 0.443999 23.6392 0.607999 24.1432 0.935999C24.6472 1.264 25.0352 1.716 25.3072 2.292L24.1432 2.964C23.7912 2.18 23.2032 1.788 22.3792 1.788C21.9792 1.788 21.6592 1.884 21.4192 2.076C21.1792 2.26 21.0592 2.512 21.0592 2.832C21.0592 3.144 21.1792 3.392 21.4192 3.576C21.6672 3.752 22.1112 3.94 22.7512 4.14C23.0712 4.244 23.3032 4.324 23.4472 4.38C23.5992 4.428 23.8072 4.508 24.0712 4.62C24.3432 4.732 24.5472 4.844 24.6832 4.956C24.8192 5.068 24.9632 5.208 25.1152 5.376C25.2752 5.544 25.3872 5.736 25.4512 5.952C25.5152 6.168 25.5472 6.412 25.5472 6.684C25.5472 7.444 25.2712 8.048 24.7192 8.496C24.1752 8.936 23.4592 9.156 22.5712 9.156ZM27.8775 0.599999H29.2575V9H27.8775V0.599999ZM37.1761 0.599999H38.5561V9H37.4761L33.5161 3.3V9H32.1361V0.599999H33.2161L37.1761 6.3V0.599999ZM49.6058 4.656V5.232C49.6058 6.384 49.2258 7.328 48.4658 8.064C47.7058 8.792 46.7138 9.156 45.4898 9.156C44.1938 9.156 43.1218 8.736 42.2738 7.896C41.4338 7.056 41.0138 6.024 41.0138 4.8C41.0138 3.584 41.4338 2.556 42.2738 1.716C43.1218 0.867999 44.1698 0.443999 45.4178 0.443999C46.2018 0.443999 46.9178 0.623999 47.5658 0.983999C48.2138 1.344 48.7178 1.828 49.0778 2.436L47.8898 3.12C47.6658 2.72 47.3338 2.4 46.8938 2.16C46.4538 1.912 45.9618 1.788 45.4178 1.788C44.5378 1.788 43.8138 2.076 43.2458 2.652C42.6778 3.228 42.3938 3.948 42.3938 4.812C42.3938 5.676 42.6778 6.392 43.2458 6.96C43.8218 7.528 44.5738 7.812 45.5018 7.812C46.2458 7.812 46.8498 7.64 47.3138 7.296C47.7858 6.944 48.0858 6.476 48.2138 5.892H45.4058V4.656H49.6058ZM61.7393 9L61.1513 7.308H57.5753L56.9873 9H55.4873L58.5353 0.599999H60.1913L63.2273 9H61.7393ZM58.0313 6.012H60.6953L59.3633 2.22L58.0313 6.012ZM68.6306 0.599999C69.7826 0.599999 70.7386 1.004 71.4986 1.812C72.2666 2.62 72.6506 3.616 72.6506 4.8C72.6506 5.976 72.2666 6.972 71.4986 7.788C70.7386 8.596 69.7826 9 68.6306 9H65.3306V0.599999H68.6306ZM68.6306 7.68C69.4226 7.68 70.0666 7.408 70.5626 6.864C71.0666 6.32 71.3186 5.632 71.3186 4.8C71.3186 3.96 71.0666 3.272 70.5626 2.736C70.0666 2.192 69.4226 1.92 68.6306 1.92H66.7106V7.68H68.6306ZM83.1488 0.599999V9H81.7688V3.012L79.2128 7.236H79.0448L76.4888 3V9H75.1088V0.599999H76.5968L79.1288 4.8L81.6728 0.599999H83.1488ZM86.0236 0.599999H87.4036V9H86.0236V0.599999ZM95.3222 0.599999H96.7022V9H95.6222L91.6622 3.3V9H90.2822V0.599999H91.3622L95.3222 6.3V0.599999ZM106.876 0.599999C107.668 0.599999 108.328 0.864 108.856 1.392C109.392 1.92 109.66 2.576 109.66 3.36C109.66 4.136 109.392 4.792 108.856 5.328C108.328 5.856 107.668 6.12 106.876 6.12H105.16V9H103.78V0.599999H106.876ZM106.876 4.824C107.284 4.824 107.62 4.688 107.884 4.416C108.148 4.136 108.28 3.784 108.28 3.36C108.28 2.936 108.148 2.588 107.884 2.316C107.62 2.036 107.284 1.896 106.876 1.896H105.16V4.824H106.876ZM116.686 9L116.098 7.308H112.522L111.934 9H110.434L113.482 0.599999H115.138L118.174 9H116.686ZM112.978 6.012H115.642L114.31 2.22L112.978 6.012ZM125.318 0.599999H126.698V9H125.618L121.658 3.3V9H120.278V0.599999H121.358L125.318 6.3V0.599999ZM130.955 7.68H134.675V9H129.575V0.599999H134.615V1.92H130.955V4.104H134.315V5.412H130.955V7.68ZM138.518 7.68H141.938V9H137.138V0.599999H138.518V7.68ZM147.895 9V7.92L150.823 4.932C151.535 4.22 151.891 3.604 151.891 3.084C151.891 2.676 151.767 2.36 151.519 2.136C151.279 1.904 150.971 1.788 150.595 1.788C149.891 1.788 149.371 2.136 149.035 2.832L147.871 2.148C148.135 1.588 148.507 1.164 148.987 0.875999C149.467 0.587999 149.999 0.443999 150.583 0.443999C151.319 0.443999 151.951 0.675999 152.479 1.14C153.007 1.604 153.271 2.236 153.271 3.036C153.271 3.892 152.795 4.804 151.843 5.772L149.947 7.668H153.427V9H147.895ZM157.246 8.88C157.07 9.056 156.858 9.144 156.61 9.144C156.362 9.144 156.15 9.056 155.974 8.88C155.798 8.704 155.71 8.492 155.71 8.244C155.71 7.996 155.794 7.784 155.962 7.608C156.138 7.432 156.354 7.344 156.61 7.344C156.858 7.344 157.07 7.432 157.246 7.608C157.422 7.784 157.51 7.996 157.51 8.244C157.51 8.492 157.422 8.704 157.246 8.88ZM165.174 7.968C164.598 8.76 163.79 9.156 162.75 9.156C161.71 9.156 160.898 8.76 160.314 7.968C159.738 7.176 159.45 6.12 159.45 4.8C159.45 3.48 159.738 2.424 160.314 1.632C160.898 0.839999 161.71 0.443999 162.75 0.443999C163.79 0.443999 164.598 0.839999 165.174 1.632C165.758 2.424 166.05 3.48 166.05 4.8C166.05 6.12 165.758 7.176 165.174 7.968ZM162.75 7.812C163.374 7.812 163.85 7.552 164.178 7.032C164.506 6.512 164.67 5.768 164.67 4.8C164.67 3.832 164.506 3.088 164.178 2.568C163.85 2.048 163.374 1.788 162.75 1.788C162.134 1.788 161.658 2.048 161.322 2.568C160.994 3.088 160.83 3.832 160.83 4.8C160.83 5.768 160.994 6.512 161.322 7.032C161.658 7.552 162.134 7.812 162.75 7.812Z"
      fill="url(#paint0_linear_1796_10092)"
    />
    <defs>
      <linearGradient
        id="paint0_linear_1796_10092"
        x1="3.39431"
        y1="4.01754"
        x2="166.434"
        y2="13.8342"
        gradientUnits="userSpaceOnUse"
      >
        <stop stopColor="#00FFD9" />
        <stop offset="0.684233" stopColor="#00C0FF" />
        <stop offset="1" stopColor="#008DFF" />
      </linearGradient>
    </defs>
  </svg>
);

const FixedContainer: FC = ({ children }) => {
  const classes = useStyles();
  return (
    <div className={classes.FixedContainer}>
      <div className={classes.SubHeader}>
        <span className="SubLogo">
          <RosingHeaderLogo />
        </span>
        dev-3 staging
      </div>
      {children}
    </div>
  );
};

const CustomUserMenu: FC<UserMenuProps> = (props) => {
  const translate = useTranslate();
  return (
    <UserMenu {...props}>
      <MenuItemLink
        className="userMenu"
        to="/configuration"
        primaryText={translate("pos.configuration")}
        leftIcon={<SettingsIcon />}
        onClick={props.onClick}
      />
    </UserMenu>
  );
};

export const CustomAppBar: FC<AppBarProps> = (props) => {
  const classes = useStyles();
  const isMobile = useMediaQuery(`@media (max-width: ${MEDIA_QUERIES_BREAKPOINTS.xs})`);
  return (
    <div>
      <AppBar
        className={classes.AppBar}
        container={FixedContainer}
        userMenu={<CustomUserMenu />}
        {...props}
      >
        <Logo />
        {!isMobile && <span className={classes.title}>SPB TV Russia</span>}
        <span className={classes.spacer} />
        <GlobalSearch />
      </AppBar>
    </div>
  );
};
